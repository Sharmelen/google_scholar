<?php

$servername = "37.59.55.185";
$username = "ZejMYc2nXj";
$password = "TtEI93o66O";
$dbname = "ZejMYc2nXj";

// Create connection
$conn = mysqli_connect($servername, $username, $password,$dbname);

// Check connection
if (!$conn) {
	
    die("Connection failed: " . mysqli_connect_error());
	
}

echo "Connected successfully";

$sql = "SELECT author.author_id, author.AUTH_COUNT, paper.title FROM author INNER JOIN
		paper ON paper.paper_id = author.paper_id";
//$sql  = "SELECT id FROM papers CROSS APPLY STRING_SPLIT(author,',')";
//$sql2  = "SELECT paper_id, title FROM author"


$result = mysqli_query($conn,$sql);

if (mysqli_num_rows($result) > 0) {
    // output data of each row
    while($row = mysqli_fetch_assoc($result)) {
		
        echo "id: " . $row["title"]. " - Author: " . $row["AUTH_COUNT"]. "<br>";
		
    }
} else {
	
    echo "0 results";
	echo "Error: " . $sql . "<br>" . mysqli_error($conn);
}

?>

<html>
  <head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {

        var data = google.visualization.arrayToDataTable([
          ['Task', 'Hours per Day'],
          <?php
		  
		  $query = "SELECT DISTINCT year, COUNT(*) FROM `paper` GROUP BY year";
					
		  $result = mysqli_query($conn,$query);
		  if (mysqli_num_rows($result) > 0){
			  
			  while($row = mysqli_fetch_assoc($result)){
				  
				  echo "['".$row['year']."',".$row['COUNT(*)']."],";
				  
				  
			  }
			  
		  }else{
			  
			   echo "0 results";
			   echo "Error: " . $sql . "<br>" . mysqli_error($conn);
			  
		  }
		  
		  
		  ?>
        ]);

        var options = {
          title: 'PAPER BASED ON YEAR'
        };

        var chart = new google.visualization.PieChart(document.getElementById('piechart'));

        chart.draw(data, options);
      }
    </script>
  </head>
  <body>
    <div id="piechart" style="width: 900px; height: 500px;"></div>
  </body>
</html>
